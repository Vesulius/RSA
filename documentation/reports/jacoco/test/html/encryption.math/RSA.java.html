<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RSA.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">encryption</a> &gt; <a href="index.source.html" class="el_package">encryption.math</a> &gt; <span class="el_source">RSA.java</span></div><h1>RSA.java</h1><pre class="source lang-java linenums">package encryption.math;

import java.math.BigInteger;

/**
 * 
 * Class that is responsible for the encryption mechanism
 * 
 * Generates and currently stores keys
 * 
 * Encrypts and decrypts String text
 * 
 */
<span class="fc" id="L14">public class RSA {</span>

    /**
     * 
     * Key generator
     * 
     * &lt;p&gt;
     * Stores keys as BigInteger arrays
     * &lt;/p&gt;
     * 
     * @param BigInteger primes for calculations
     * @return String array with lenght 3 for all keys in bytes
     * 
     */
    public String[] generateKeys(BigInteger p, BigInteger q, BigInteger e) {
        // Random random = new Random();
<span class="fc" id="L30">        BigInteger one = BigInteger.ONE;</span>

        // p and q must be primes

<span class="fc" id="L34">        BigInteger n = p.multiply(q);</span>

        // phi(n) = c
        // phi is Euler's totient function
        // phi(n) is the number of integers from 1 to n that coprime with n
<span class="fc" id="L39">        BigInteger c = p.subtract(one).multiply(q.subtract(one));</span>

        // 2 conditions for e:
        // 1: 1 &lt; e &lt; c
        // 2: coprime with c
        // multiple algorithms to solve this:
        // https://en.wikipedia.org/wiki/Greatest_common_divisor#Calculation
        // this also works: just chose a prime between 1 and c

        // (d * e) % c = 1
        // Can be calculated using Extended Euclidean algorithm:
        // https://en.wikipedia.org/wiki/Extended_Euclidean_algorithm
<span class="fc" id="L51">        BigInteger d = e.modInverse(c);</span>
        

        // integers for encryption: e, n
        // integers for decryption: d, n
        
<span class="fc" id="L57">        String[] keys = new String[3];</span>

<span class="fc" id="L59">        keys[0] = e.toString();</span>
<span class="fc" id="L60">        keys[1] = d.toString();</span>
<span class="fc" id="L61">        keys[2] = n.toString();</span>

<span class="fc" id="L63">        return keys;</span>
    }

    /**
     * 
     * Encrypts given String text and returns encrypted text as String
     * 
     * Uses publickey from this class to encrypt message
     * Maxium message size is currently 128 characters
     * 
     * @param message String text to be crypted
     * @return Encrypted text as String
     */
    public String encrypt(String message, String[] publicKey) {
<span class="fc" id="L77">        BigInteger e = new BigInteger(publicKey[0]);</span>
<span class="fc" id="L78">        BigInteger n = new BigInteger(publicKey[1]);</span>

<span class="fc" id="L80">        byte[] byteMessage = message.getBytes();</span>
<span class="fc" id="L81">        BigInteger encyptedMessage = new BigInteger(byteMessage).modPow(e, n);</span>
<span class="fc" id="L82">        return encyptedMessage.toString();</span>
    }

    /**
     * 
     * Decrypts given String text and returns decrypted text as String
     * 
     * Uses privatekey from this class to encrypt message
     * 
     * @param encryptedMessage Encrypted String message to be decrypted
     * @return Decrypted message as String
     */
    public String decrypt(String encryptedMessage, String[] privateKey) {
<span class="fc" id="L95">        BigInteger d = new BigInteger(privateKey[0]);</span>
<span class="fc" id="L96">        BigInteger n = new BigInteger(privateKey[1]);</span>

<span class="fc" id="L98">        BigInteger message = new BigInteger(encryptedMessage);</span>
<span class="fc" id="L99">        BigInteger decryptedMessage = message.modPow(d, n);</span>
<span class="fc" id="L100">        return new String(decryptedMessage.toByteArray());</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>